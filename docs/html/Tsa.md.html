<meta charset="utf-8">
<style>* { padding: 0; margin: 0; }body { width: 90%; margin: 0 auto; padding: 1em 2em 2em; font-family: "Times New Roman"; border: 1px solid #eee; }h1 { border-bottom: 1px solid #eee; }h1, h2, h3, h4, h5 { padding: 0.4em 0; margin-bottom: 0.5em; }p { border-left: 0.4em #DDDDDD solid; padding: 0.1em 1em 0.5em; background: #FEFFFF; font-size: 0.9em; font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; }hr { background: #E7E7E7; height: 0.2em; border: 0px; margin: 1em 0; }pre { margin: 1em 0; padding-bottom: 1em; background: #F7F7F7; font-size: 0.9em; font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; word-wrap: break-word; overflow-x: auto; }code { background: #F5F5F5; padding: 0 0.5em; border: #E0E0E0 1px solid; color: #E21149; font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; }</style>
<body>
<h1>SPA PHP SDK 主要服务类 Tsa\Tsa</h1>

Tsa\Tsa 类提供了主要功能的接口入口

<hr>

<h1>Tsa\Tsa</h1>

<h2>快速调用</h2>

<h3>初始化实例</h3>

<pre><codeblock>
    $conf = array(
        'appid'            => '{appid}',   // 必填
        'appkey'           => '{appkey}',  // 必填
        'http_client_type' => 'curl',      // 可不填
        'version'          => 'v3'         // 可不填
    );

    $spa = new Tsa\Tsa($conf);

    // 获取模块集合
    $modules = $spa->getModules();
</codeblock></pre>

<h3>选择请求的模块和接口并发送请求</h3>

<pre><codeblock>
    // 选择模块 -> 选择接口 -> 发送请求
    $modules->advertiser->signup->send({$params}, {$headers});
</codeblock></pre>

<h3>详细解说</h3>

首先是对于模块（module）和接口（interface）的选择

<pre><codeblock>
    // 返回了 advertiser 模块
    $advertiser = $modules->advertiser;

    // 返回接口 signup 的请求实体
    $signup = $advertiser->signup;

    // 向 advertiser/signup 发送请求
    $signup->send({$params}, {$headers});
</codeblock></pre>

也支持链式操作

<pre><codeblock>
    // 选择模块 -> 选择接口 -> 发送请求
    $response = $spa->getModules()->advertiser->signup->send({$params}, {$headers});
</codeblock></pre>

接下来是数据的拼接，在 <code>Tsa\Object\Enum\</code> 下定义了各个模块中各个接口参数的枚举类

<pre><codeblock>
    // Tsa\Object\Enum\ {mod_class} \ {interface_enum_class}
    use Tsa\Object\Enum\Advertiser\SignupEnum;

    $params = array(
        SignupEnum::LOGIN_NAME       => '',
        SignupEnum::ADVERTISER_NAME  => '',
        SignupEnum::CORPORATION_NAME => '',
        SignupEnum::ADDRESS          => '',
    );
</codeblock></pre>

上述例子等同于：

<pre><codeblock>
    $params = array(
        'login_name'       => '',
        'advertiser_name'  => '',
        'corporation_name' => '',
        'address'          => '',
    );
</codeblock></pre>

<hr>

<h2>传统调用：</h2>

<h3>初始化实例</h3>

<pre><codeblock>
    $conf = array(
        'appid'            => '{appid}',
        'appkey'           => '{appkey}',
        'http_client_type' => 'curl',
        'version'          => 'v3'
    );

    $spa = new Tsa\Tsa($conf);
</codeblock></pre>

<h3>发送 get 请求</h3>

<pre><codeblock>
    $response = $spa->get('/advertiser/read?advertiser_id=123', {$headers});
</codeblock></pre>

<h3>发送 post 请求</h3>

<pre><codeblock>
    $response = $spa->post('/advertiser/signup', {$params}, {$headers});
</codeblock></pre>

<h3>发送 request 请求</h3>

<pre><codeblock>
    $response = $spa->sendRequest('post', '/advertiser/signup', {$params}, {$headers});
</codeblock></pre>

<h2>详细介绍：</h2>

<h3>初始化配置 $conf</h3>
<p><code>appid</code>: API授权接入方唯一身份标识，目前为申请API接入的直客或代理商id；</p><p><code>appkey</code>: 开通API授权后获得的私钥，在开通授权邮件中会与app_id一块提供；</p><p><code>http_client_type</code>: 选填项，目前只支持 <code>curl</code>，（选填）</p><p><code>version</code>: api 版本，默认 <code>v3</code>，目前只支持 <code>v3</code>，（选填）</p>

<h2>Tsa 类提供的方法</h2>

<hr>

<h3>getApp()</h3>

<pre><codeblock>
    public Tsa\App getApp()
</codeblock></pre>

返回在本次请求中 <code>Tsa\App</code> 的实例

<hr>

<h3>getClient()</h3>

<pre><codeblock>
    public Tsa\Client getClient()
</codeblock></pre>

返回在本次请求中 <code>Tsa\Client</code> 的实例

<hr>

<h3>get()</h3>

<pre><codeblock>
    public Tsa\Response get(
        $url,
        $headers = array(), 
        $access_token = null
    )
</codeblock></pre>
<p><code>$url</code>: {string} 请求的 url，（必填）</p><p><code>$headers</code>: {array|array()} 请求要传的请求头信息，（选填）</p><p><code>$access_token</code>: {AccessToken|string|null} access token，不填的话自动从 $conf 中的配置信息生成，（选填）</p>
<br>发起一个 <code>get</code> 请求，返回值为 <code>Tsa\Response</code> 对象

<hr>

<h3>post()</h3>

<pre><codeblock>
    public Tsa\Response post(
        $url,
        $params = array(), 
        $headers = array(), 
        $access_token = null
    )
</codeblock></pre>
<p><code>$url</code>: {string} 请求的 url，（必填）</p><p><code>$params</code>: {array|array()} post 请求参数信息，（选填）</p><p><code>$headers</code>: {array|array()} 请求要传的请求头信息，（选填）</p><p><code>$access_token</code>: {AccessToken|string|null} access token，不填的话自动从 $conf 中的配置信息生成，（选填）</p>
<br>发起一个 <code>post</code> 请求，返回值为 <code>Tsa\Response</code> 对象

<hr>

<h3>sendRequest()</h3>

<pre><codeblock>
    public Tsa\Response sendRequest(
        $method,
        $url,
        $params = array(),
        $headers = array(),
        $access_token = null
    )
</codeblock></pre>
<p><code>$method</code>: {string} 请求方式 GET/POST</p><p><code>$url</code>: {string} 请求的 url，（必填）</p><p><code>$params</code>: {array|array()} 请求参数信息，（选填）</p><p><code>$headers</code>: {array|array()} 请求要传的请求头信息，（选填）</p><p><code>$access_token</code>: {AccessToken|string|null} access token，不填的话自动从 $conf 中的配置信息生成，（选填）</p>
<br>发送 <code>request</code> 请求，自己指定请求方式，只支持 <code>GET / POST</code>，返回值为 <code>Tsa\Response</code> 对象

<hr>

<h3>request()</h3>

<pre><codeblock>
    public Tsa\Request request(
        $method,
        $url,
        $params = array(),
        $headers = array(),
        $access_token = null
    )
</codeblock></pre>
<p><code>$method</code>: {string} 请求方式 GET/POST</p><p><code>$url</code>: {string} 请求的 url，（必填）</p><p><code>$params</code>: {array|array()} 请求参数信息，（选填）</p><p><code>$headers</code>: {array|array()} 请求要传的请求头信息，（选填）</p><p><code>$access_token</code>: {AccessToken|string|null} access token，不填的话自动从 $conf 中的配置信息生成，（选填）</p>
<br>收集处理 <code>request</code> 请求信息，返回值为 <code>Tsa\Request</code> 对象

<hr>

<h3>getModules()</h3>

<pre><codeblock>
    public Tsa\Object\Modules getModules()
</codeblock></pre>

返回模块的集合，用于选择要请求的模块

<pre><codeblock>
    $response = $spa->getModules()->advertiser->signup->send({$params}, {$headers});
</codeblock></pre>

</body>